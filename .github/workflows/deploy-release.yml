name: Promote release to production branch

on:
  release:
    types: [published]

jobs:
  promote:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # needed to push the production branch

    steps:
      # Checkout EXACTLY the tag that the release refers to
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: ${{ github.ref }}  # e.g. refs/tags/v1.1.0

      - name: Fast-forward production to release tag
        run: |
          TAG="${GITHUB_REF_NAME}"      # v1.1.0
          git checkout -B production    # branch at current HEAD (the tag commit)
          git push origin production --force-with-lease
