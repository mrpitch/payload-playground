name: Promote release to production branch

on:
  release:
    types: [published]
  # or:
  # push:
  #   tags: ["v*"]

jobs:
  promote:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Move production branch to the release tag commit
      - name: Fast-forward production to release tag
        run: |
          git fetch --tags origin
          TAG="${GITHUB_REF_NAME}"   # for "release" event, this is the tag name
          git checkout -B production "refs/tags/$TAG"
          git push origin production --force-with-lease
